<div class="row">
  <div class="col-md-12 page-header">
    <h2 class="page-title">EVENT</h2>
  </div>
</div>

<div class="row">
  <div class="col-md-12">
    <div class="card">
      <div class="content">
        <div class="row">
          <div class="col-md-12">
            <h4 class="text-center">List of events</h4>
          </div>
          <div class="col-md-12 d-flex flex-row justify-content-between align-items-center">
            <span style="width: 10%;">
              Search:
              <i class="fa fa-refresh cursor-pointer" (click)="load()"></i>
            </span>
            <input type="text" class="form-control" name="search" [(ngModel)]="searchTerm"
                   placeholder="Search by event name or league name" (ngModelChange)="searchSubject.next(searchTerm)"/>
            <button class="btn btn-primary" type="button" (click)="load()">Submit</button>
          </div>
          <div class="col-md-12 row">
            <div class="col-2 d-flex">
              <span class="fw-bold">Team name</span>
              <input type="checkbox" name="teamName" class="form-check ms-2" [(ngModel)]="data.isTeam">
            </div>

            <div class="col-2 d-flex">
              <span class="fw-bold">Exact name</span>
              <input type="checkbox" name="exactName" class="form-check ms-2" [(ngModel)]="data.exact">
            </div>
          </div>

          <div class="canvas-wrapper">
            <table class="table table-striped table-bordered table-list">
              <thead class="success">
              <tr>
                <th class="text-left">Event ID</th>
                <th class="text-left">League Name</th>
                <th class="text-left">Event Name</th>
                <th class="text-left">Event Date</th>
                <th class="text-left">Score</th>
                <th class="text-left">Open Odd</th>
                <th class="text-left">Link</th>
              </tr>
              </thead>
              <tbody>
                @defer (when !loading) {
                  <tr>
                    <td colspan="99" class="text-center fw-bold table-info">
                      Total events: {{ data.total | number:'1.0-0' }}
                    </td>
                  </tr>
                  @if (data.isTeam && data.exact) {
                    <tr>
                      <td colspan="99" class="table-light">
                        <p class="text-dark fw-bold">
                          Exact match for team name: <span class="text-success">"{{ searchTerm }}"</span>
                        </p>
                        <ol class="d-flex flex-column text-danger">
                          <li class="text-dark fw-bold">FT SCORE (MIN / MAX / AVG):
                            <span class="text-success">
                              {{ data.detail?.minFtScore }} / {{ data.detail?.maxFtScore }}
                              / {{ data.detail?.avgFtScore | number:'1.2-2' }} goals
                            </span>
                          </li>
                          <li class="text-dark fw-bold">HT SCORE (MIN / MAX / AVG):
                            <span class="text-success">
                              {{ data.detail?.minHtScore }} / {{ data.detail?.maxHtScore }}
                              / {{ data.detail?.avgHtScore | number:'1.2-2' }} goals
                            </span>
                          </li>
                          <li class="text-dark fw-bold">CORNER (MIN / MAX / AVG):
                            <span class="text-success">
                              {{ data.detail?.minCorner }} / {{ data.detail?.maxCorner }}
                              / {{ data.detail?.avgCorner | number:'1.2-2' }} corners
                            </span>
                          </li>
                        </ol>
                      </td>
                    </tr>
                  }
                  @for (l of data.data; track l) {
                    <tr class="row-hover">
                      <td class="text-left"><i class="flag-icon flag-icon-us"></i> {{ l.eventId }}</td>
                      <td class="text-left align-middle" [ngClass]="{'gradient-text': l.isMainLeague}">
                        <img [src]="l.logoHome" alt="" style="width: 32px;">
                        <span>{{ l.leagueName }}</span>
                      </td>
                      <td class="text-left ">
                        <div class="d-flex justify-content-between w-100 align-middle align-items-center">
                          <span class="team-name text-end"
                                [ngClass]="{'text-primary fw-bold': data.isTeam && l.homeTeam.toLowerCase() === searchTerm.toLowerCase()}">{{ l.homeTeam }}</span>
                          <img [src]="l.logoHome" alt="" style="width: 32px;">
                          <span class="vs text-center">vs</span>
                          <img [src]="l.logoAway" alt="" style="width: 32px;">
                          <span class="team-name text-start"
                                [ngClass]="{'text-primary fw-bold': data.isTeam && l.awayTeam.toLowerCase() === searchTerm.toLowerCase()}">{{ l.awayTeam }}</span>
                        </div>
                      </td>
                      <td class="text-left">{{ l.eventDate | date: 'dd/MM/yyyy HH:mm z' : '+0700' }}</td>
                      <td class="text-left">
                        <div class="d-flex flex-column">
                          <span>{{ l.htScore.replace('HT', 'HT: ') }}</span>
                          <span>FT: {{ l.ftScore }}</span>
                          <span>Corner: {{ l.cornerScore }}</span>
                        </div>
                      </td>
                      <td>
                        <div class="d-flex flex-column">
                          <span>HDC: {{ l.parsedOddInfo.hdc?.line }}</span>
                          <span>OU: {{ l.parsedOddInfo.ou?.line }}</span>
                          <span>Corner: {{ l.parsedOddInfo.corner?.line }}</span>
                        </div>
                      </td>
                      <td class="text-left">
                        <a class="text-decoration-none" href="javascript:void(0)"
                           (click)="openPopup(l.link, l.eventName)">
                          <i class="fas fa-link"></i> {{ l.eventName }}
                        </a>
                      </td>
                    </tr>
                  } @empty {
                    <tr>
                      <td colspan="99" class="text-center">No events found.</td>
                    </tr>
                  }
                } @placeholder {
                  <tr>
                    <td colspan="99" class="text-center">⏳ Đang tải dữ liệu trận đấu...</td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
